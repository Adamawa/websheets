<head>
   <title>Websheets Manual</title>
   <link rel="icon" type="image/png" href="favicon.png">
   <link rel="stylesheet" href="websheet.css?7">
   <script type="text/javascript" 
    src="http://ajax.googleapis.com/ajax/libs/jquery/1/jquery.min.js"></script>
</head>
<body>
 <div id="page">
 <h1>Websheets Manual</h1>
 This manual describes how to write new exercises. It doesn't 
 cover installation &mdash; see the README or the 
 <a href="https://github.com/daveagp/websheets">git repository</a> instead.

<h2>Format Overview</h2>

If you look in the <a href="https://github.com/daveagp/websheets/tree/master/exercises"><tt>exercises</tt> directory</a>,
you will see a bunch of <tt>.py</tt> files. Each one of them defines a single Websheet exercise. Here is the
 simplest example &mdash; it is 
<a href="https://github.com/daveagp/websheets/blob/master/exercises/TwoPlusTwo.py"><tt>TwoPlusTwo.py</tt></a>:

<pre id='eg4' style='border:1px solid teal'>
source_code = r"""
public static void main(String[] args) {
\[
   System.out.print(2+2);
]\
}
"""

description = r"""
Fill in the program so it &lt;i&gt;prints&lt;/i&gt; out the integer obtained by adding 2 and 2.
"""

tests = r"""
testMain();
"""
</pre>

This defines a Python module, using triple-quotes so that the strings can span multiple
lines, and using the <tt>r&quot;&quot;&quot;</tt> raw-string prefix so that you don't need to escape backslashes.
However, that is all the Python you need to know.

<p>
See this definition in action by visiting the <a href="index.php?group=TwoPlusTwo"><tt>TwoPlusTwo</tt>
websheet</a>. Try making some correct and incorrect submissions.
<p>
So at its core, a websheet is a list of field names, each taking on a string value.
Reviewing the above, you must define the fields

<ul>
<li><tt>source_code</tt>, a correct reference Java program with 
some areas <tt>\[</tt> blanked out <tt>]\</tt> to be filled in by the student, 
<li><tt>tests</tt>, a snippet of Java code calling the testing API, 
which compares the behaviour of the student's solution and the reference solution
<li><tt>description</tt>, an HTML fragment that will be shown to the student,
that explains what they should do.
</ul>

<p>Note: there are a few other optional fields beyond these three.

<p>
Here are the sections of this manual, which describe how to write each 
component in more detail:
 <ul id='sections'>
 </ul>
 <script type='text/javascript'>
$(function() { // do this on load
  var toc = "";
  $("h2, h3").each(function(i, header) {
    if ($(header).is("h2") && toc != "") toc += "</ul>";
    toc += "<li><a href='#sect"+i+"'>"+$(header).html()+"</a></li>";
    if ($(header).is("h2")) toc += "<ul>";
    $(header).prepend("<a id='sect"+i+"'></a>");
  });
  toc += "</ul>";
  console.log(toc);
  $("#sections").html(toc);
});
 </script>

Of course, looking at existing examples is the most thorough way to understand
what's going on, once you're familiar with the main concepts in this manual.

<h2><tt>source_code</tt>: The reference solution and blank locations</h2>

When writing a websheet, normally you will start by writing 
the <tt>source_code</tt> as a correct solution to the problem. (Note that 
you can either write in <tt>public class ExerciseName</tt> like 
<a href="https://github.com/daveagp/websheets/blob/master/exercises/HelloWorld.py"><tt>HelloWorld.py</tt></a>
or leave it out, like <tt>TwoPlusTwo</tt> above.)

<p>
Once you fill in a working program, you need to decide on what parts
you want to blank out for the student.
For the purposes of websheets, every blank has to 
fall in one of the following two categories:
<ul>
<li><i>inline blanks</i> which start and end on the same line; they can expand horizontally, but can never contain newlines
<li><i>multi-line blanks</i> which take up the entirety of several lines; they can expand vertically, but never can start or
end in the middle of a line
</ul>
For example, the <a href="index.php?group=Distance"><tt>Distance</tt> websheet</a> has both kinds of blanks.
Try typing some stuff in the blanks and see how they resize to accomodate unlimited student input.

<p>
Both kinds of blanks are indicated by using <tt>\[</tt> to denote the start of the blank,
and <tt>]\</tt> to denote the end of the blank. The interior region will be left blank and editable for
the user, while anything not between <tt>\[...]\</tt> delimiters will be read-only. (E.g., 
recall the <a href='#eg4'><tt>TwoPlusTwo</tt></a> example.)

<p>
The rules for how these delimiters must appear in <tt>source_code</tt> are:
<ul>
<li><i>inline blanks</i> are defined by <tt>\[</tt> and <tt>\]</tt> on the same line
<li><i>multi-line blanks</i> are defined by <tt>\[</tt> on a line by itself, followed some lines later by <tt>]\</tt>
on a line by itself.
</ul>

<p>
For example, look at how
<a href="https://github.com/daveagp/websheets/blob/master/exercises/Distance.py"><tt>Distance.py</tt></a>
defines both kinds of blanks.

<p>
(In the multi-line case, additional whitespace on the lines
containing the delimiters is currently ignored, although it
could be meaningful in a later version where Python is used and 
we want to force indentation of a region.)

<h3>Hidden code, fake code, default contents for blanks</h3>
The simple <tt>\[...]\</tt> delimiters are sufficient to describe
a large variety of exercises. But to allow the exercise writer
more flexibility, websheets allow a few additional kinds of regions.

<p>
You can use <tt>\hide[...]\</tt> to enter code that will be hidden
from the student's UI. It will be included in both the reference
solution and the student's combined solution that gets executed upon submission.
For examples, see
<ul>
<li><tt>NSwap</tt>, where it is used in-line to hide a call to <tt>.clone()</tt>
<li><tt>CountingSort</tt>, where it is used multi-line to include an inner class
</ul>

<p>
You can use <tt>\fake[...]\</tt> to display read-only text in the user interface
that looks like it is part of the program, but that won't actually be included.
For examples, see
<ul>
<li><tt>NSwap</tt>, where it is used in-line to show pseudocode in the middle of a program
<li><tt>SquareSwap</tt>, where it is used similarly, but to contain multiple lines
</ul>

<p>
You can use <tt>\show:</tt> to have a blank initially populated with some text.
(Think of providing a buggy program fragment for a student to fix.) To do this,
change <tt>\[ blanked-out text ]\</tt> to <tt>\[ blanked-out text \show: default text here ]\</tt>.
For example, see
<ul>
<li><tt>Vector</tt>, where it is used in multi-line syntax to give a strawman constructor
<li>(No current example uses the in-line syntax.)
</ul>

<h3>Cheatsheet: What elements appear where?</h3>
<style type='text/css'>
table td, table th {
    border: 1px solid black;
}
</style>
<table style="border:1px solid black;border-collapse:collapse">
<tr><td></td><td>in UI?</td><td>in reference solution?</td><td>in executed/tested combined student solution?</td></tr>
<tr><th>plain text</th>            <td>yes (read-only)</td>   <td>yes</td> <td>yes</td>
</tr><tr>
<th>blanked-out <tt>\[...]\)</tt></th> <td>yes (editable, initially blank)</td> 
<td>yes</td> <td>yes (edited student text spliced in)</td>
</tr><tr>
<th><tt>\show:</tt> of blanked-out:</th> <td>yes (editable)</td> <td>no</td> <td>yes (edited student text spliced in)</td>
</tr><tr>
<th><tt>\fake[ ... ]\</tt></th>         <td>yes (read-only)</td><td>no</td><td>no</td>
</tr><tr>
<th><tt>\hide[ ... ]\</tt></th>        <td>no</td>                   <td>yes</td> <td>yes</td>
</tr>
</table>

<h2><tt>description</tt>: The Exercise Description, in HTML</h2>

You can use as few or as many HTML elements as you like in describing the
exercise. The simplest descriptions are just text, using <tt>&lt;p&gt;</tt> to separate
paragraphs, and sometimes using <tt>&lt;tt&gt;</tt> and <tt>&lt;pre&gt;</tt> to use a monospace font.

<p>
<b>LaTeX.</b> All websheets have MathJaX processing turned on. This means that you can
include LaTeX using $inline format$ or $$big centered display format$$.
Look at <a href="https://github.com/daveagp/websheets/blob/master/exercises/Distance.py"><tt>Distance.py</tt></a>
 and the resulting <a href="index.php?group=Distance"</a><tt>Distance</tt> websheet</a>
for examples of both.

<p>
<b>Links.</b> Sometimes you'll want to add a link to another websheet inside 
of the description. One way to do this nicely is to write a link with a URL like
<pre>&lt;a href="?group=SquareSwap"&gt;SquareSwap&lt;/a&gt;</pre>
Look at <a href="https://github.com/daveagp/websheets/blob/master/exercises/NSwap.py"><tt>NSwap.py</tt></a>
 and the resulting <a href="index.php?group=NSwap"</a><tt>NSwap</tt> websheet</a>
for example.

<p>
<b>Diagrams.</b>
You can use any software and any formats you like, but the example exercises 
using diagrams 
(<a href="index.php?group=SquareSwap+FourChargeClient"</a><tt>SquareSwap</tt> and <tt>FourChargeClient</tt></a>)
were created using <a href="http://ipe7.sourceforge.net/">IPE</a> (which uses PDFs as an editable format)
and rasterized using  <a href="https://github.com/daveagp/websheets/blob/master/exercises/render.sh"><tt>render.sh</tt></a>.

<h2><tt>tests</tt>: What the grader should test (subject to change!)</h2>

The <tt>tests</tt> contains a snippet of Java code that makes calls to
our testing API. These API calls cause the automatic grader to dynamically
execute both the reference code and student code in separate namespaces,
capturing their outputs and return values, and comparing the results
for correctness.

<p>
Because <tt>tests</tt> will be spliced in to a Java program, any valid Java
code can be used. For example, instead of writing
<pre>
testMain("AA");
testMain("BB");
&hellip;
testMain("ZZ");
</pre>
you could write
<pre>
for (char ch='A'; ch<='Z'; ch++) testMain(""+ch+ch);
</pre>

You can even define 
<a href="http://docs.oracle.com/javase/tutorial/java/javaOO/localclasses.html">local</a> or
<a href="http://docs.oracle.com/javase/tutorial/java/javaOO/anonymousclasses.html">anonymous</a>
classes if you need to define methods or classes, although no current examples do this.

<p>
The testing API still needs to be refactored (should be done by mid-July). So 
this is not yet fully documented, as it is subject to major changes.
However, as of time of writing, here are the different things that
are part of current tests:

<pre>
cloneForStudent = {boolean}
construct(null, "Person", "", "Tony");
construct("stdlibpack", "Queue", "&lt;Integer&gt;");
dontRunReference = {boolean}
expectException = {boolean}
testConstructor();
HTMLdescription = {String}
quietOnPass = {boolean}
remark(String)
saveAs = {String}
var(String)
setMaxOutputBytes
store()
test()
testConstructor()
testMain()
testNamedMain()
testOn()
testStdin = {String}
testStdinURL = {String}
</pre>

<h2>Optional Websheet Fields</h2>
Here are a couple of other fields that are available for use in websheets.

<dl>
<dt><tt>classname</tt></dt>
<dd> when you want the visible and executed class name not to be the 
  same as the name of the overall exercise (the Python module name,
  referred to internally as the slug).</dd>
<dd>
E.g. <a href="https://github.com/daveagp/websheets/blob/master/exercises/MonkeyAddStart.py"><tt>MonkeyAddStart.py</tt></a>
and <a href="index.php?group=MonkeyAddStart">websheet</a>.
</dd>

<dt><tt>show_class_decl</tt></dt>
<dd>
set to <tt>False</tt> if you don't want the user to
  see the class declaration.</dd>
<dd>
E.g. <a href="https://github.com/daveagp/websheets/blob/master/exercises/SquareSwap.py"><tt>SquareSwap.py</tt></a>
and <a href="index.php?group=SquareSwap">websheet</a>.
</dd>

<dt><tt>epilogue</tt></dt>
<dd>show a message or explanation after problem is completed.</dd>
<dd>
E.g. <a href="https://github.com/daveagp/websheets/blob/master/exercises/PercentScore.py"><tt>PercentScore.py</tt></a>
and <a href="index.php?group=PercentScore">websheet</a>.
</dd>

<dt><tt>dependencies</tt></dt>
<dd> require student to complete some other websheet before
 this one; student's solution to the dependency will be made available when compiling executing this one.</dd>
<dd>
E.g. <a href="https://github.com/daveagp/websheets/blob/master/exercises/TigerBook.py"><tt>TigerBook.py</tt></a>
and <a href="index.php?group=TigerBook">websheet</a>.
</dd>
<dd>
Note: if instead you want to give student extra reference code without requiring them
to actually complete the dependency, you can use <tt>\hide</tt> instead:
</dd>
<dd>
E.g. <a href="https://github.com/daveagp/websheets/blob/master/exercises/CountingSort.py"><tt>CountingSort.py</tt></a>
and <a href="index.php?group=CountingSort">websheet</a>.
</dd>

<dt><tt>imports</tt></dt>
<dd>a list of classes to import (will be made visible in UI and added to reference solution)
</dd>
<dd>
E.g. <a href="https://github.com/daveagp/websheets/blob/master/exercises/CME.py"><tt>CME.py</tt></a>
and <a href="index.php?group=CME">websheet</a>.
</dd>

</dl>

 </div>
</body>
