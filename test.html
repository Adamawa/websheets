<html>

<head>

   <script type="text/javascript" src="http://ajax.googleapis.com/ajax/libs/jquery/1/jquery.min.js"></script>
   <script type="text/javascript" src="CodeMirror/lib/codemirror.js"></script>
   <script type="text/javascript" src="CodeMirror/mode/clike/clike.js"></script>

   <link rel="stylesheet" href="CodeMirror/lib/codemirror.css">
   <link rel="stylesheet" href="CodeMirror/theme/neat.css">

<style type='text/css'>
.inline {background-color: #FDD}
pre.block {background-color: #EFE}
pre.block span {background-color: #DFD !important;}

.CodeMirror {
  border: 1px solid #eee;
  height: auto;
}
.CodeMirror-scroll {
  overflow-y: hidden;
  overflow-x: auto;
  box-sizing: border-box;
}
.CodeMirror {
  font-family: Monaco, Menlo, 'Ubuntu Mono', 'Droid Sans Mono', Consolas, monospace;
  font-size: 14px;
  line-height: 16px;
}
</style>

<script type='text/javascript'>

$( function() {

var cm = CodeMirror.fromTextArea(document.getElementById("code"),
  {
  mode: "text/x-java",
  theme: "neat", tabSize: 3, indentUnit: 3,
  lineNumbers: true,
  viewportMargin: Infinity});

cm.setValue("public static  max3(  ) {\n\n}");

function compare(pos1, pos2) {
 // 1: pos1 later; -1: pos1 earlier; 0: identical
  if (pos1.line < pos2.line) return -1;
  if (pos1.line > pos2.line) return 1;
  if (pos1.ch < pos2.ch) return -1;
  if (pos1.ch > pos2.ch) return 1;
  return 0;
}

function contains_strictly(int1, int2) {
  return (compare(int1.from, int2.from) < 0)
      && (compare(int2.to, int1.to) < 0);
}

var inline = [
     cm.markText({line: 0, ch: 13}, {line: 0, ch: 15},
            {readOnly: false, 
            className: "inline",
                       inclusiveLeft: true, inclusiveRight: true}),
     cm.markText({line: 0, ch: 20}, {line: 0, ch: 22},
            {readOnly: false, 
            className: "inline",
                       inclusiveLeft: true, inclusiveRight: true})
                       ];


var block = [
     cm.markText({line: 0, ch: 25}, {line: 2, ch: 0},
            {readOnly: false, 
            className: "block",
                       inclusiveLeft: true, inclusiveRight: true})
                       ];

var user = [inline[0], inline[1], block[0]];

// this is better than readOnly since it works when you surround read-only text
// and try to change the whole selection
cm.on("beforeChange", function(cm, change) {
   for (var i=0; i<user.length; i++) {
      var mrange = user[i].find();
      if (contains_strictly(mrange, change)) return;
   }
   change.cancel();
});

cm.on("renderLine", function(cm, line, elt) {
     var ln = cm.getLineNumber(line);
     for (var i=0; i<block.length; i++) {
      var mrange = block[i].find();
                                  // <= looked too goofy
      if (mrange && mrange.from.line < ln && mrange.to.line > ln)
      {       //console.log(elt);// cm.addLineClass(line, "background", "green");
      $(elt).addClass("block");}
    }
});

cm.refresh();

});

</script>
</head>
<body>
<textarea id="code" name="code"></textarea>
</body>
</html>